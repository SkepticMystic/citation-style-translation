/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

// Source: https://stackoverflow.com/questions/4320958/regular-expression-for-recognizing-in-text-citations
const authorReg = "(?:[A-Z][A-Za-z'`-]+)";
const etal = '(?:et al.?)';
const additional = '(?:,? (?:(?:and |& )?' + authorReg + '|' + etal + '))';
const year_num = '(?:19|20)[0-9][0-9]';
const page_num = '(?:, p.? [0-9]+)?';
const year = '(?:, *' + year_num + page_num + '| *(' + year_num + page_num + '))';
const citeRegex = new RegExp('(' + authorReg + additional + '*' + year + ';?)+', 'g');

function copy(content) {
    return __awaiter(this, void 0, void 0, function* () {
        yield navigator.clipboard.writeText(content).then(() => new obsidian.Notice("Copied to clipboard"), () => new obsidian.Notice("Could not copy to clipboard"));
    });
}

class CSTSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        let { containerEl } = this;
        containerEl.empty();
        // containerEl.createEl('h2', { text: 'Settings for my awesome plugin.' });
    }
}

const DEFAULT_SETTINGS = {};
class CSTPlugin extends obsidian.Plugin {
    constructor() {
        super(...arguments);
        this.authorName = (author) => {
            if (author.family) {
                return author.family;
            }
            else if (author.literal) {
                return author.literal;
            }
        };
        this.Pandoc2Cites = () => __awaiter(this, void 0, void 0, function* () {
            const content = yield this.getSelectionText();
            const refs = this.getCitationEntries();
            if (!refs) {
                return;
            }
            // Array of pandoc citations: `['[@1]', '[@2]', ...]`
            const pandocCites = content.match(/\[@.+?\]/g);
            let replacement = content.slice();
            pandocCites.forEach(pCite => {
                let currBracket = '';
                const keys = pCite.replace(/\[(.+?)\]/, '$1');
                const splitKeys = keys.split(';');
                if (splitKeys.length > 1) { // Multi-bracket
                    splitKeys.forEach((key, i) => {
                        const citekey = key.trim().slice(1);
                        const intextCite = this.citekey2inText(citekey, refs);
                        if (i === 0) {
                            currBracket += `(${intextCite}; `;
                        }
                        else if (i !== splitKeys.length - 1) {
                            currBracket += `${intextCite}; `;
                        }
                        else {
                            currBracket += `${intextCite})`;
                        }
                    });
                    replacement = replacement.replaceAll(pCite, currBracket);
                }
                else { // Single bracket
                    const citekey = splitKeys[0].slice(1);
                    const intextCite = `(${this.citekey2inText(citekey, refs)})`;
                    replacement = replacement.replaceAll(pCite, intextCite);
                }
            });
            console.log({ replacement });
            copy(replacement);
        });
        this.cites2Pandoc = () => __awaiter(this, void 0, void 0, function* () {
            const content = yield this.getSelectionText();
            const refs = this.getCitationEntries();
            if (!refs) {
                return;
            }
            const cites = content.match(citeRegex);
            console.log({ cites });
            let replacements = content.slice();
            if (cites) {
                const citeMap = cites.map((original) => {
                    const firstAuthor = original.match(authorReg)[0];
                    const year = original.match(/\d{4}/g)[0];
                    return { original, firstAuthor, year };
                });
                console.log({ citeMap });
                // Replace cites with pandoc cites
                citeMap.forEach((cite, i) => {
                    var _a;
                    const matchingRef = refs.find(ref => {
                        var _a;
                        return ((_a = ref.author) === null || _a === void 0 ? void 0 : _a.some(author => (author === null || author === void 0 ? void 0 : author.family) === cite.firstAuthor ||
                            (author === null || author === void 0 ? void 0 : author.literal) === cite.firstAuthor))
                            &&
                                ref.issued['date-parts'][0][0].toString() === cite.year;
                    });
                    if (matchingRef) {
                        console.log({ matchingRef });
                        const { original } = cite;
                        const { id } = matchingRef;
                        if ( // Start of a multi-cite
                        original.endsWith(';') &&
                            (!citeMap[i - 1] || !citeMap[i - 1].original.endsWith(';'))) {
                            replacements = replacements.replaceAll(`(${original}`, `[@${id};`);
                        }
                        else if ( // Middle of a multi-cite
                        original.endsWith(';') &&
                            citeMap[i - 1].original.endsWith(';')) {
                            replacements = replacements.replaceAll(original, `@${id};`);
                        }
                        else if ( // End of a multi-cite
                        !original.endsWith(';') &&
                            ((_a = citeMap[i - 1]) === null || _a === void 0 ? void 0 : _a.original.endsWith(';'))) {
                            replacements = replacements.replaceAll(`${original})`, `@${id}]`);
                        }
                        else { // Regular cite
                            replacements = replacements.replaceAll(`(${original})`, `[@${id}]`);
                        }
                    }
                });
                console.log(replacements);
            }
            else {
                return;
            }
            // Latex â†’ Pandoc
            replacements = replacements.replaceAll(/\\cite\{(.+?)\}/g, '[@$1]');
            copy(replacements);
        });
    }
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log('loading plugin');
            yield this.loadSettings();
            this.addCommand({
                id: 'cites2Pandoc',
                name: 'Convert cites2Pandoc and copy to clipboard',
                callback: this.cites2Pandoc
            });
            this.addCommand({
                id: 'Pandoc2Cites',
                name: 'Convert Pandoc2Cites and copy to clipboard',
                callback: this.Pandoc2Cites
            });
            this.addSettingTab(new CSTSettingTab(this.app, this));
        });
    }
    getSelectionText() {
        return __awaiter(this, void 0, void 0, function* () {
            var text = "";
            if (window.getSelection) {
                text = window.getSelection().toString();
            }
            if (text !== '') {
                return text;
            }
            else {
                const currFile = this.app.workspace.getActiveFile();
                return (yield this.app.vault.cachedRead(currFile));
            }
        });
    }
    getCitationEntries() {
        var _a, _b;
        let entries = (_b = (_a = this.app.plugins.plugins['obsidian-citation-plugin']) === null || _a === void 0 ? void 0 : _a.library) === null || _b === void 0 ? void 0 : _b.entries;
        if (!entries) {
            new obsidian.Notice('Please enable the Citations plugin');
            return;
        }
        let refs = Object.values(entries).map(entry => entry.data);
        return refs;
    }
    /**
     * Given a `citekey` grab the corresponding in-text citation (no brackets)
     * @param  {string} citekey
     * @param  {Entry[]} refs
     * @returns {string} `Author & Another et al., Year`
     */
    citekey2inText(citekey, refs) {
        const ref = refs.find(ref => ref.id === citekey);
        if (!ref)
            return;
        const year = ref.issued['date-parts'][0][0];
        let authorStr;
        if (ref.author.length <= 2) {
            authorStr = ref.author.map(this.authorName).join(' & ');
        }
        else {
            authorStr = `${this.authorName(ref.author[0])} et al.`;
        }
        console.log({ year, authorStr });
        return `${authorStr}, ${year}`;
    }
    onunload() {
        console.log('unloading plugin');
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.saveData(this.settings);
        });
    }
}

module.exports = CSTPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsInNyYy9jb250YW50cy50cyIsInNyYy91dGlsLnRzIiwic3JjL0NTVFNldHRpbmdUYWIudHMiLCJzcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcbiIsIi8vIFNvdXJjZTogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDMyMDk1OC9yZWd1bGFyLWV4cHJlc3Npb24tZm9yLXJlY29nbml6aW5nLWluLXRleHQtY2l0YXRpb25zXHJcbmV4cG9ydCBjb25zdCBhdXRob3JSZWcgPSBcIig/OltBLVpdW0EtWmEteidgLV0rKVwiO1xyXG5jb25zdCBldGFsID0gJyg/OmV0IGFsLj8pJztcclxuY29uc3QgYWRkaXRpb25hbCA9ICcoPzosPyAoPzooPzphbmQgfCYgKT8nICsgYXV0aG9yUmVnICsgJ3wnICsgZXRhbCArICcpKSc7XHJcbmNvbnN0IHllYXJfbnVtID0gJyg/OjE5fDIwKVswLTldWzAtOV0nO1xyXG5jb25zdCBwYWdlX251bSA9ICcoPzosIHAuPyBbMC05XSspPyc7XHJcbmNvbnN0IHllYXIgPVxyXG4gICAgJyg/OiwgKicgKyB5ZWFyX251bSArIHBhZ2VfbnVtICsgJ3wgKignICsgeWVhcl9udW0gKyBwYWdlX251bSArICcpKSc7XHJcbmV4cG9ydCBjb25zdCBjaXRlUmVnZXggPSBuZXcgUmVnRXhwKCcoJyArIGF1dGhvclJlZyArIGFkZGl0aW9uYWwgKyAnKicgKyB5ZWFyICsgJzs/KSsnLCAnZycpOyIsImltcG9ydCB7IE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvcHkoY29udGVudDogc3RyaW5nKSB7XHJcbiAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb250ZW50KS50aGVuKFxyXG4gICAgICAgICgpID0+IG5ldyBOb3RpY2UoXCJDb3BpZWQgdG8gY2xpcGJvYXJkXCIpLFxyXG4gICAgICAgICgpID0+IG5ldyBOb3RpY2UoXCJDb3VsZCBub3QgY29weSB0byBjbGlwYm9hcmRcIilcclxuICAgICk7XHJcbn0iLCJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCBDU1RQbHVnaW4gZnJvbSAnLi9tYWluJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDU1RTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgICBwbHVnaW46IENTVFBsdWdpbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBDU1RQbHVnaW4pIHtcclxuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgICB9XHJcblxyXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcclxuICAgICAgICBsZXQgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgLy8gY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU2V0dGluZ3MgZm9yIG15IGF3ZXNvbWUgcGx1Z2luLicgfSk7XHJcblxyXG5cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBOb3RpY2UsIFBsdWdpbiB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgYXV0aG9yUmVnLCBjaXRlUmVnZXggfSBmcm9tICdzcmMvY29udGFudHMnO1xyXG5pbXBvcnQgeyBjb3B5IH0gZnJvbSAnc3JjL3V0aWwnO1xyXG5pbXBvcnQgeyBDU1RTZXR0aW5nVGFiIH0gZnJvbSAnLi9DU1RTZXR0aW5nVGFiJztcclxuXHJcbmludGVyZmFjZSBDU1RTZXR0aW5ncyB7IH1cclxuaW50ZXJmYWNlIEVudHJ5IHtcclxuXHRpZDogc3RyaW5nLFxyXG5cdGF1dGhvcj86IEF1dGhvcltdLFxyXG5cdGlzc3VlZD86IHsgJ2RhdGUtcGFydHMnOiBudW1iZXJbXVtdIH1cclxufVxyXG5pbnRlcmZhY2UgQXV0aG9yIHtcclxuXHRmYW1pbHk/OiBzdHJpbmcsXHJcblx0Z2l2ZW4/OiBzdHJpbmcsXHJcblx0bGl0ZXJhbD86IHN0cmluZ1xyXG59XHJcblxyXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBDU1RTZXR0aW5ncyA9IHt9XHJcblxyXG5kZWNsYXJlIG1vZHVsZSAnb2JzaWRpYW4nIHtcclxuXHRpbnRlcmZhY2UgQXBwIHtcclxuXHRcdHBsdWdpbnM6IHtcclxuXHRcdFx0cGx1Z2luczoge1xyXG5cdFx0XHRcdCdvYnNpZGlhbi1jaXRhdGlvbi1wbHVnaW4nOiB7XHJcblx0XHRcdFx0XHRsaWJyYXJ5OiB7XHJcblx0XHRcdFx0XHRcdGVudHJpZXM6IHtcclxuXHRcdFx0XHRcdFx0XHRbaWQ6IHN0cmluZ106IHtcclxuXHRcdFx0XHRcdFx0XHRcdGRhdGE6IEVudHJ5XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENTVFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcblx0c2V0dGluZ3M6IENTVFNldHRpbmdzO1xyXG5cclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRjb25zb2xlLmxvZygnbG9hZGluZyBwbHVnaW4nKTtcclxuXHJcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XHJcblx0XHRcdGlkOiAnY2l0ZXMyUGFuZG9jJyxcclxuXHRcdFx0bmFtZTogJ0NvbnZlcnQgY2l0ZXMyUGFuZG9jIGFuZCBjb3B5IHRvIGNsaXBib2FyZCcsXHJcblx0XHRcdGNhbGxiYWNrOiB0aGlzLmNpdGVzMlBhbmRvY1xyXG5cdFx0fSk7XHJcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xyXG5cdFx0XHRpZDogJ1BhbmRvYzJDaXRlcycsXHJcblx0XHRcdG5hbWU6ICdDb252ZXJ0IFBhbmRvYzJDaXRlcyBhbmQgY29weSB0byBjbGlwYm9hcmQnLFxyXG5cdFx0XHRjYWxsYmFjazogdGhpcy5QYW5kb2MyQ2l0ZXNcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ1NUU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgZ2V0U2VsZWN0aW9uVGV4dCgpIHtcclxuXHRcdHZhciB0ZXh0ID0gXCJcIjtcclxuXHRcdGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XHJcblx0XHRcdHRleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKTtcclxuXHRcdH1cclxuXHRcdGlmICh0ZXh0ICE9PSAnJykge1xyXG5cdFx0XHRyZXR1cm4gdGV4dFxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29uc3QgY3VyckZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpXHJcblx0XHRcdHJldHVybiAoYXdhaXQgdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZChjdXJyRmlsZSkpXHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRnZXRDaXRhdGlvbkVudHJpZXMoKSB7XHJcblx0XHRsZXQgZW50cmllcyA9IHRoaXMuYXBwLnBsdWdpbnMucGx1Z2luc1snb2JzaWRpYW4tY2l0YXRpb24tcGx1Z2luJ10/LmxpYnJhcnk/LmVudHJpZXNcclxuXHRcdGlmICghZW50cmllcykgeyBuZXcgTm90aWNlKCdQbGVhc2UgZW5hYmxlIHRoZSBDaXRhdGlvbnMgcGx1Z2luJyk7IHJldHVybiB9XHJcblx0XHRsZXQgcmVmcyA9IE9iamVjdC52YWx1ZXMoZW50cmllcykubWFwKGVudHJ5ID0+IGVudHJ5LmRhdGEpXHJcblx0XHRyZXR1cm4gcmVmc1xyXG5cdH1cclxuXHJcblx0YXV0aG9yTmFtZSA9IChhdXRob3I6IEF1dGhvcikgPT4ge1xyXG5cdFx0aWYgKGF1dGhvci5mYW1pbHkpIHsgcmV0dXJuIGF1dGhvci5mYW1pbHkgfVxyXG5cdFx0ZWxzZSBpZiAoYXV0aG9yLmxpdGVyYWwpIHsgcmV0dXJuIGF1dGhvci5saXRlcmFsIH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEdpdmVuIGEgYGNpdGVrZXlgIGdyYWIgdGhlIGNvcnJlc3BvbmRpbmcgaW4tdGV4dCBjaXRhdGlvbiAobm8gYnJhY2tldHMpXHJcblx0ICogQHBhcmFtICB7c3RyaW5nfSBjaXRla2V5XHJcblx0ICogQHBhcmFtICB7RW50cnlbXX0gcmVmc1xyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9IGBBdXRob3IgJiBBbm90aGVyIGV0IGFsLiwgWWVhcmBcclxuXHQgKi9cclxuXHRjaXRla2V5MmluVGV4dChjaXRla2V5OiBzdHJpbmcsIHJlZnM6IEVudHJ5W10pOiBzdHJpbmcge1xyXG5cdFx0Y29uc3QgcmVmID0gcmVmcy5maW5kKHJlZiA9PiByZWYuaWQgPT09IGNpdGVrZXkpXHJcblx0XHRpZiAoIXJlZikgcmV0dXJuXHJcblxyXG5cdFx0Y29uc3QgeWVhciA9IHJlZi5pc3N1ZWRbJ2RhdGUtcGFydHMnXVswXVswXVxyXG5cdFx0bGV0IGF1dGhvclN0cjogc3RyaW5nO1xyXG5cclxuXHRcdGlmIChyZWYuYXV0aG9yLmxlbmd0aCA8PSAyKSB7XHJcblx0XHRcdGF1dGhvclN0ciA9IHJlZi5hdXRob3IubWFwKHRoaXMuYXV0aG9yTmFtZSkuam9pbignICYgJylcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGF1dGhvclN0ciA9IGAke3RoaXMuYXV0aG9yTmFtZShyZWYuYXV0aG9yWzBdKX0gZXQgYWwuYFxyXG5cdFx0fVxyXG5cdFx0Y29uc29sZS5sb2coeyB5ZWFyLCBhdXRob3JTdHIgfSlcclxuXHJcblx0XHRyZXR1cm4gYCR7YXV0aG9yU3RyfSwgJHt5ZWFyfWBcclxuXHR9XHJcblxyXG5cdFBhbmRvYzJDaXRlcyA9IGFzeW5jICgpID0+IHtcclxuXHRcdGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmdldFNlbGVjdGlvblRleHQoKVxyXG5cdFx0Y29uc3QgcmVmcyA9IHRoaXMuZ2V0Q2l0YXRpb25FbnRyaWVzKClcclxuXHRcdGlmICghcmVmcykgeyByZXR1cm4gfVxyXG5cclxuXHRcdC8vIEFycmF5IG9mIHBhbmRvYyBjaXRhdGlvbnM6IGBbJ1tAMV0nLCAnW0AyXScsIC4uLl1gXHJcblx0XHRjb25zdCBwYW5kb2NDaXRlcyA9IGNvbnRlbnQubWF0Y2goL1xcW0AuKz9cXF0vZylcclxuXHJcblx0XHRsZXQgcmVwbGFjZW1lbnQgPSBjb250ZW50LnNsaWNlKCk7XHJcblx0XHRwYW5kb2NDaXRlcy5mb3JFYWNoKHBDaXRlID0+IHtcclxuXHRcdFx0bGV0IGN1cnJCcmFja2V0ID0gJydcclxuXHRcdFx0Y29uc3Qga2V5cyA9IHBDaXRlLnJlcGxhY2UoL1xcWyguKz8pXFxdLywgJyQxJylcclxuXHRcdFx0Y29uc3Qgc3BsaXRLZXlzID0ga2V5cy5zcGxpdCgnOycpXHJcblxyXG5cdFx0XHRpZiAoc3BsaXRLZXlzLmxlbmd0aCA+IDEpIHsgLy8gTXVsdGktYnJhY2tldFxyXG5cdFx0XHRcdHNwbGl0S2V5cy5mb3JFYWNoKChrZXksIGkpID0+IHtcclxuXHRcdFx0XHRcdGNvbnN0IGNpdGVrZXkgPSBrZXkudHJpbSgpLnNsaWNlKDEpO1xyXG5cdFx0XHRcdFx0Y29uc3QgaW50ZXh0Q2l0ZSA9IHRoaXMuY2l0ZWtleTJpblRleHQoY2l0ZWtleSwgcmVmcylcclxuXHRcdFx0XHRcdGlmIChpID09PSAwKSB7XHJcblx0XHRcdFx0XHRcdGN1cnJCcmFja2V0ICs9IGAoJHtpbnRleHRDaXRlfTsgYFxyXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChpICE9PSBzcGxpdEtleXMubGVuZ3RoIC0gMSkge1xyXG5cdFx0XHRcdFx0XHRjdXJyQnJhY2tldCArPSBgJHtpbnRleHRDaXRlfTsgYFxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0Y3VyckJyYWNrZXQgKz0gYCR7aW50ZXh0Q2l0ZX0pYFxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0cmVwbGFjZW1lbnQgPSByZXBsYWNlbWVudC5yZXBsYWNlQWxsKHBDaXRlLCBjdXJyQnJhY2tldClcclxuXHRcdFx0fSBlbHNlIHsgLy8gU2luZ2xlIGJyYWNrZXRcclxuXHRcdFx0XHRjb25zdCBjaXRla2V5ID0gc3BsaXRLZXlzWzBdLnNsaWNlKDEpXHJcblx0XHRcdFx0Y29uc3QgaW50ZXh0Q2l0ZSA9IGAoJHt0aGlzLmNpdGVrZXkyaW5UZXh0KGNpdGVrZXksIHJlZnMpfSlgXHJcblx0XHRcdFx0cmVwbGFjZW1lbnQgPSByZXBsYWNlbWVudC5yZXBsYWNlQWxsKHBDaXRlLCBpbnRleHRDaXRlKVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0Y29uc29sZS5sb2coeyByZXBsYWNlbWVudCB9KVxyXG5cdFx0Y29weShyZXBsYWNlbWVudClcclxuXHR9XHJcblxyXG5cclxuXHRjaXRlczJQYW5kb2MgPSBhc3luYyAoKSA9PiB7XHJcblx0XHRjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRTZWxlY3Rpb25UZXh0KClcclxuXHRcdGNvbnN0IHJlZnMgPSB0aGlzLmdldENpdGF0aW9uRW50cmllcygpXHJcblx0XHRpZiAoIXJlZnMpIHsgcmV0dXJuIH1cclxuXHJcblx0XHRjb25zdCBjaXRlcyA9IGNvbnRlbnQubWF0Y2goY2l0ZVJlZ2V4KVxyXG5cdFx0Y29uc29sZS5sb2coeyBjaXRlcyB9KVxyXG5cclxuXHRcdGxldCByZXBsYWNlbWVudHMgPSBjb250ZW50LnNsaWNlKClcclxuXHRcdGlmIChjaXRlcykge1xyXG5cdFx0XHRjb25zdCBjaXRlTWFwID0gY2l0ZXMubWFwKChvcmlnaW5hbCkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGZpcnN0QXV0aG9yID0gb3JpZ2luYWwubWF0Y2goYXV0aG9yUmVnKVswXTtcclxuXHRcdFx0XHRjb25zdCB5ZWFyID0gb3JpZ2luYWwubWF0Y2goL1xcZHs0fS9nKVswXVxyXG5cdFx0XHRcdHJldHVybiB7IG9yaWdpbmFsLCBmaXJzdEF1dGhvciwgeWVhciB9O1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0Y29uc29sZS5sb2coeyBjaXRlTWFwIH0pXHJcblxyXG5cdFx0XHQvLyBSZXBsYWNlIGNpdGVzIHdpdGggcGFuZG9jIGNpdGVzXHJcblx0XHRcdGNpdGVNYXAuZm9yRWFjaCgoY2l0ZSwgaSkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IG1hdGNoaW5nUmVmID0gcmVmcy5maW5kKHJlZiA9PlxyXG5cdFx0XHRcdFx0cmVmLmF1dGhvcj8uc29tZShhdXRob3IgPT5cclxuXHRcdFx0XHRcdFx0YXV0aG9yPy5mYW1pbHkgPT09IGNpdGUuZmlyc3RBdXRob3IgfHxcclxuXHRcdFx0XHRcdFx0YXV0aG9yPy5saXRlcmFsID09PSBjaXRlLmZpcnN0QXV0aG9yXHJcblx0XHRcdFx0XHQpXHJcblx0XHRcdFx0XHQmJlxyXG5cdFx0XHRcdFx0cmVmLmlzc3VlZFsnZGF0ZS1wYXJ0cyddWzBdWzBdLnRvU3RyaW5nKCkgPT09IGNpdGUueWVhcilcclxuXHJcblx0XHRcdFx0aWYgKG1hdGNoaW5nUmVmKSB7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyh7IG1hdGNoaW5nUmVmIH0pXHJcblx0XHRcdFx0XHRjb25zdCB7IG9yaWdpbmFsIH0gPSBjaXRlXHJcblx0XHRcdFx0XHRjb25zdCB7IGlkIH0gPSBtYXRjaGluZ1JlZlxyXG5cdFx0XHRcdFx0aWYgKCAvLyBTdGFydCBvZiBhIG11bHRpLWNpdGVcclxuXHRcdFx0XHRcdFx0b3JpZ2luYWwuZW5kc1dpdGgoJzsnKSAmJlxyXG5cdFx0XHRcdFx0XHQoIWNpdGVNYXBbaSAtIDFdIHx8ICFjaXRlTWFwW2kgLSAxXS5vcmlnaW5hbC5lbmRzV2l0aCgnOycpKVxyXG5cdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdHJlcGxhY2VtZW50cyA9IHJlcGxhY2VtZW50cy5yZXBsYWNlQWxsKGAoJHtvcmlnaW5hbH1gLCBgW0Ake2lkfTtgKVxyXG5cdFx0XHRcdFx0fSBlbHNlIGlmICggLy8gTWlkZGxlIG9mIGEgbXVsdGktY2l0ZVxyXG5cdFx0XHRcdFx0XHRvcmlnaW5hbC5lbmRzV2l0aCgnOycpICYmXHJcblx0XHRcdFx0XHRcdGNpdGVNYXBbaSAtIDFdLm9yaWdpbmFsLmVuZHNXaXRoKCc7JylcclxuXHRcdFx0XHRcdCkge1xyXG5cdFx0XHRcdFx0XHRyZXBsYWNlbWVudHMgPSByZXBsYWNlbWVudHMucmVwbGFjZUFsbChvcmlnaW5hbCwgYEAke2lkfTtgKVxyXG5cdFx0XHRcdFx0fSBlbHNlIGlmICggLy8gRW5kIG9mIGEgbXVsdGktY2l0ZVxyXG5cdFx0XHRcdFx0XHQhb3JpZ2luYWwuZW5kc1dpdGgoJzsnKSAmJlxyXG5cdFx0XHRcdFx0XHRjaXRlTWFwW2kgLSAxXT8ub3JpZ2luYWwuZW5kc1dpdGgoJzsnKVxyXG5cdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdHJlcGxhY2VtZW50cyA9IHJlcGxhY2VtZW50cy5yZXBsYWNlQWxsKGAke29yaWdpbmFsfSlgLCBgQCR7aWR9XWApXHJcblx0XHRcdFx0XHR9IGVsc2UgeyAvLyBSZWd1bGFyIGNpdGVcclxuXHRcdFx0XHRcdFx0cmVwbGFjZW1lbnRzID0gcmVwbGFjZW1lbnRzLnJlcGxhY2VBbGwoYCgke29yaWdpbmFsfSlgLCBgW0Ake2lkfV1gKVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSlcclxuXHRcdFx0Y29uc29sZS5sb2cocmVwbGFjZW1lbnRzKVxyXG5cdFx0fSBlbHNlIHsgcmV0dXJuIH1cclxuXHJcblx0XHQvLyBMYXRleCDihpIgUGFuZG9jXHJcblx0XHRyZXBsYWNlbWVudHMgPSByZXBsYWNlbWVudHMucmVwbGFjZUFsbCgvXFxcXGNpdGVcXHsoLis/KVxcfS9nLCAnW0AkMV0nKVxyXG5cdFx0Y29weShyZXBsYWNlbWVudHMpXHJcblx0fVxyXG5cdG9udW5sb2FkKCkge1xyXG5cdFx0Y29uc29sZS5sb2coJ3VubG9hZGluZyBwbHVnaW4nKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuXHR9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJOb3RpY2UiLCJQbHVnaW5TZXR0aW5nVGFiIiwiUGx1Z2luIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdURBO0FBQ08sU0FBUyxTQUFTLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO0FBQzdELElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsT0FBTyxLQUFLLFlBQVksQ0FBQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxVQUFVLE9BQU8sRUFBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO0FBQ2hILElBQUksT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxDQUFDLEVBQUUsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQy9ELFFBQVEsU0FBUyxTQUFTLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtBQUNuRyxRQUFRLFNBQVMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtBQUN0RyxRQUFRLFNBQVMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENB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
